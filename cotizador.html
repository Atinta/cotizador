<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador de Stickers Atinta</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background-color: transparent; 
        }
        .sofia-morales-cotizador { 
            font-family: 'Inter', sans-serif; 
            -webkit-font-smoothing: antialiased; 
            -moz-osx-font-smoothing: grayscale; 
        }
        .sofia-morales-cotizador .action-bg { background-color: #E5007E; }
        .sofia-morales-cotizador .action-text { color: #E5007E; }
        .sofia-morales-cotizador .selected-option { 
            border-color: #E5007E; 
            box-shadow: 0 0 0 2px #E5007E; 
            transform: scale(1.02); 
        }
        .sofia-morales-cotizador .option-button { transition: all 0.2s ease-in-out; }
        .sofia-morales-cotizador .form-input { transition: all 0.2s ease-in-out; }
        .sofia-morales-cotizador .form-input.invalid { 
            border-color: #EF4444; 
            box-shadow: 0 0 0 2px #FECACA; 
        }
        .sofia-morales-cotizador .collapsible-content.hidden, 
        .sofia-morales-cotizador .error-message.hidden { 
            opacity: 0; 
            max-height: 0; 
            margin-top: 0; 
            overflow: hidden; 
            transition: all 0.3s ease-out; 
        }
        .sofia-morales-cotizador .collapsible-content, 
        .sofia-morales-cotizador .error-message { 
            opacity: 1; 
            max-height: 2000px; 
            transition: all 0.3s ease-in; 
        }
        .sofia-morales-cotizador .spinner { 
            border: 2px solid rgba(255, 255, 255, 0.3); 
            border-radius: 50%; 
            border-top-color: #fff; 
            width: 16px; 
            height: 16px; 
            animation: spin 1s ease-in-out infinite; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes price-update-glow { 
            0% { background-color: transparent; } 
            40% { background-color: #dbeafe; box-shadow: 0 0 12px #bfdbfe; } 
            100% { background-color: transparent; } 
        }
        .sofia-morales-cotizador .price-updated { animation: price-update-glow 0.8s ease-out; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        .sofia-morales-cotizador .ready-to-submit {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>

<div class="sofia-morales-cotizador">
    <div class="bg-white p-4 md:p-8 rounded-2xl shadow-xl max-w-5xl mx-auto">
        <div class="text-center mb-8 md:mb-10">
            <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900 tracking-tight">Crea tu Sticker Perfecto</h2>
            <p class="max-w-xl mx-auto text-base md:text-lg text-gray-600 mt-2">Configura tus opciones y obtén tu precio al instante.</p>
        </div>
        
        <form id="cotizador-form" action="https://formsubmit.co/benjamin@stickersatinta.com" method="POST" enctype="multipart/form-data">
            
            <input type="hidden" name="_next" value="https://www.stickersatinta.com/gracias">
            <input type="hidden" name="_captcha" value="false">

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 lg:gap-16">
                
                <div class="space-y-6">
                    <div id="step-1">
                        <label class="font-bold text-lg text-gray-800 block mb-3">1. Elige la Forma</label>
                        <div id="shape-options" class="grid grid-cols-3 gap-2 md:gap-4"></div>
                        <div id="rounded-corners-container" class="collapsible-content hidden mt-4">
                            <label class="flex items-center space-x-2 cursor-pointer bg-gray-50 p-3 rounded-lg">
                                <input type="checkbox" id="rounded-corners-checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="text-gray-700 font-medium">Bordes Redondeados</span>
                            </label>
                        </div>
                    </div>
                    <div id="step-2">
                        <label class="font-bold text-lg text-gray-800 block mb-3">2. Ingresa las Dimensiones (cm)</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <input id="width" type="number" inputmode="decimal" placeholder="Ancho" class="form-input w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" aria-label="Ancho en centímetros">
                                <p id="width-error" class="error-message hidden text-red-500 text-sm mt-1"></p>
                            </div>
                            <div>
                                <input id="height" type="number" inputmode="decimal" placeholder="Alto" class="form-input w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" aria-label="Alto en centímetros">
                                <p id="height-error" class="error-message hidden text-red-500 text-sm mt-1"></p>
                            </div>
                        </div>
                    </div>
                    <div id="step-3">
                        <label class="font-bold text-lg text-gray-800 block mb-3">3. Elige el Material</label>
                        <div id="material-options" class="space-y-3"></div>
                        <div id="finish-options-container" class="collapsible-content hidden mt-4">
                             <label class="font-bold text-md text-gray-700 block mb-2">3a. Elige el Acabado</label>
                             <div id="finish-options" class="grid grid-cols-2 gap-4"></div>
                        </div>
                    </div>
                    <div id="step-4">
                        <label for="quantity" class="font-bold text-lg text-gray-800 block mb-3">4. Ingresa la Cantidad</label>
                        <input id="quantity" type="number" inputmode="decimal" class="form-input w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ej: 1500" aria-label="Cantidad de stickers">
                        <p id="quantity-error" class="error-message hidden text-red-500 text-sm mt-1"></p>
                    </div>
                </div>

                <div class="lg:sticky top-8 h-fit">
                    <div id="summary-card" class="bg-gray-50 rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Resumen de Cotización</h3>
                        <div id="price-summary-container" class="space-y-3 text-gray-600 mb-6" aria-live="polite">
                            <div class="flex justify-between"><span>Forma:</span> <span id="summary-shape" class="font-semibold">--</span></div>
                            <div class="flex justify-between"><span>Tamaño:</span> <span id="summary-size" class="font-semibold">--</span></div>
                            <div class="flex justify-between"><span>Material:</span> <span id="summary-material" class="font-semibold">--</span></div>
                            <div class="flex justify-between"><span>Cantidad:</span> <span id="summary-quantity" class="font-semibold">--</span></div>
                        </div>
                        <div class="border-t border-gray-300 pt-4 mb-6 space-y-2">
                            <div class="flex justify-between items-center"><span class="text-md text-gray-600">Valor Unitario (Neto):</span><span id="unit-price" class="text-md font-semibold text-gray-800">$0</span></div>
                            <div class="flex justify-between items-center"><span class="text-md text-gray-600">Valor Neto:</span><span id="net-price" class="text-md font-semibold text-gray-800">$0</span></div>
                            <div class="flex justify-between items-center"><span class="text-md text-gray-600">IVA (19%):</span><span id="iva-price" class="text-md font-semibold text-gray-800">$0</span></div>
                            <div id="total-price-wrapper" class="flex justify-between items-center mt-2 pt-2 border-t border-dashed rounded-md -mx-2 px-2"><span class="text-lg font-bold">Total a Pagar:</span><span id="total-price" class="text-2xl md:text-3xl font-black action-text">$0</span></div>
                        </div>
                         <div id="contact-details" class="border-t border-gray-300 pt-4 space-y-4">
                            <h3 class="font-bold text-lg text-gray-800">Tus Datos para Enviar</h3>
                            <div>
                                <label for="name" class="text-sm font-medium text-gray-700">Nombre</label>
                                <input type="text" id="name" name="name" required class="form-input mt-1 block w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                             <div>
                                <label for="email" class="text-sm font-medium text-gray-700">Email</label>
                                <input type="email" id="email" name="email" required class="form-input mt-1 block w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <button id="submit-button" type="submit" class="w-full py-3 text-lg font-bold text-white action-bg rounded-lg shadow-md hover:opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center">
                                <span id="submit-button-text">Enviar Cotización</span>
                                <div id="submit-spinner" class="spinner hidden"></div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const CONFIG = {
        ivaRate: 0.19,
        minimumQuantity: 1000,
        maximumQuantity: 180000,
        materials: {
            vinilo_blanco_mate: { name: 'Vinilo Blanco Mate', costPerSqm: 680 },
            vinilo_transparente_mate: { name: 'Vinilo Transparente Mate', costPerSqm: 680 },
            tinta: { costPerSqm: 352 }
        },
        productionCosts: {
            laborRatePerHour: 3500,
            prepPressMinutes: 120,
            printerSetupMinutes: 30,
            cutterSetupMinutes: 20,
            printSpeedSqmPerHour: 6.7,
            wasteTiers: [
                { minQuantity: 100000, percentage: 0.20 },
                { minQuantity: 15000, percentage: 0.25 },
                { minQuantity: 1000, percentage: 0.30 }
            ],
            outsourcing: [
                { minQuantity: 80000, guillotineCost: 200000, extraLaborDays: 2 },
                { minQuantity: 40000, guillotineCost: 100000, extraLaborDays: 1 }
            ],
            extraLaborCostPerDay: 28000,
            packagingCostTiers: [
                { minQuantity: 50000, cost: 150000 },
                { minQuantity: 1000, cost: 50000 }
            ]
        },
        priceTiers: [
            { minQuantity: 180000, markup: 2.0 }, { minQuantity: 150000, markup: 2.02 }, { minQuantity: 100000, markup: 2.05 },
            { minQuantity: 75000,  markup: 2.08 }, { minQuantity: 50000,  markup: 2.11 }, { minQuantity: 30000,  markup: 2.16 },
            { minQuantity: 20000,  markup: 2.2 }, { minQuantity: 15000,  markup: 2.23 }, { minQuantity: 10000,  markup: 2.26 },
            { minQuantity: 7500,   markup: 2.29 }, { minQuantity: 5000,   markup: 2.33 },{ minQuantity: 3500,   markup: 2.37 },
            { minQuantity: 2500,   markup: 2.4 },{ minQuantity: 1500,   markup: 2.46 },{ minQuantity: 1000,   markup: 2.5 }
        ],
        shapes: [ 
            { id: 'rectangular', name: 'Rectangular', multiplier: 1.0, icon: '<svg class="w-8 h-8 md:w-10 md:h-10 mx-auto mb-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 3h16v16H4z"></path></svg>' },
            { id: 'circular', name: 'Circular', multiplier: 1.0, icon: '<svg class="w-8 h-8 md:w-10 md:h-10 mx-auto mb-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21a9 9 0 110-18 9 9 0 010 18z"></path></svg>' },
            { id: 'troquelado', name: 'Troquelado', multiplier: 1.3, icon: '<svg class="w-8 h-8 md:w-10 md:h-10 mx-auto mb-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>' }
        ],
        materialOptions: [ 
            { id: 'vinilo_blanco', name: 'Vinilo Blanco', finishes: { mate: { name: 'Mate', costKey: 'vinilo_blanco_mate' }, brillante: { name: 'Brillante', costKey: 'vinilo_blanco_mate' } } },
            { id: 'vinilo_transparente', name: 'Vinilo Transparente', finishes: { mate: { name: 'Mate', costKey: 'vinilo_transparente_mate' }, brillante: { name: 'Brillante', costKey: 'vinilo_transparente_mate' } } }
        ]
    };
    const state = { shape: null, width: null, height: null, material: null, finish: null, quantity: null, roundedCorners: false, touched: { width: false, height: false, quantity: false } };
    const dom = {
        shapeOptions: document.querySelector('#shape-options'),
        roundedCornersContainer: document.querySelector('#rounded-corners-container'),
        roundedCornersCheckbox: document.querySelector('#rounded-corners-checkbox'),
        materialOptions: document.querySelector('#material-options'),
        finishOptionsContainer: document.querySelector('#finish-options-container'),
        finishOptions: document.querySelector('#finish-options'),
        inputs: { width: document.querySelector('#width'), height: document.querySelector('#height'), quantity: document.querySelector('#quantity') },
        errors: { width: document.querySelector('#width-error'), height: document.querySelector('#height-error'), quantity: document.querySelector('#quantity-error') },
        summary: { shape: document.querySelector('#summary-shape'), size: document.querySelector('#summary-size'), material: document.querySelector('#summary-material'), quantity: document.querySelector('#summary-quantity'), unitPrice: document.querySelector('#unit-price'), netPrice: document.querySelector('#net-price'), ivaPrice: document.querySelector('#iva-price'), totalPrice: document.querySelector('#total-price'), totalPriceWrapper: document.querySelector('#total-price-wrapper') },
        submitButton: document.querySelector('#submit-button')
    };

    const calculator = {
        getBaseConfig: () => {
            const { shape, width, height, material, finish } = state;
            if (!shape || !width || !height || !material || !finish) return null;
            const selectedShape = CONFIG.shapes.find(s => s.id === shape);
            const selectedMaterial = CONFIG.materialOptions.find(m => m.id === material);
            const selectedFinish = selectedMaterial.finishes[finish];
            return { stickerAreaCm2: width * height, shapeMultiplier: selectedShape.multiplier, materialCostKey: selectedFinish.costKey };
        },
        getRealCost: (quantity, baseConfig) => {
            if (!baseConfig) return { totalCost: 0, unitCost: 0 };
            const pc = CONFIG.productionCosts;
            const laborRatePerMinute = pc.laborRatePerHour / 60;
            const totalSetupMinutes = pc.prepPressMinutes + pc.printerSetupMinutes + pc.cutterSetupMinutes;
            const totalSetupCost = totalSetupMinutes * laborRatePerMinute;
            const stickerAreaM2 = baseConfig.stickerAreaCm2 / 10000;
            const totalStickerAreaM2 = stickerAreaM2 * quantity * baseConfig.shapeMultiplier;
            const wasteTier = pc.wasteTiers.find(t => quantity >= t.minQuantity);
            const wastePercentage = wasteTier ? wasteTier.percentage : 0;
            const totalMaterialAreaM2 = totalStickerAreaM2 * (1 + wastePercentage);
            const materialCost = CONFIG.materials[baseConfig.materialCostKey].costPerSqm;
            const totalMaterialCost = (materialCost + CONFIG.materials.tinta.costPerSqm) * totalMaterialAreaM2;
            const printingHours = totalMaterialAreaM2 / pc.printSpeedSqmPerHour;
            const printingCost = printingHours * pc.laborRatePerHour;
            let outsourcingCost = 0;
            const outsourcingTier = pc.outsourcing.find(t => quantity >= t.minQuantity);
            if (outsourcingTier) {
                outsourcingCost += outsourcingTier.guillotineCost;
                outsourcingCost += outsourcingTier.extraLaborDays * pc.extraLaborCostPerDay;
            }
            const packagingTier = pc.packagingCostTiers.find(t => quantity >= t.minQuantity);
            const packagingCost = packagingTier ? packagingTier.cost : 0;
            const totalCost = totalSetupCost + totalMaterialCost + printingCost + outsourcingCost + packagingCost;
            return { totalCost, unitCost: totalCost / quantity };
        },
        forQuantity: (quantity, baseConfig, tiers) => {
            if (!baseConfig || !tiers) return { netPrice: 0, unitPrice: 0 };
            const currentTier = tiers.find(tier => quantity >= tier.minQuantity);
            const markup = currentTier ? currentTier.markup : 1;
            const { unitCost } = calculator.getRealCost(quantity, baseConfig);
            const finalUnitPrice = unitCost * markup;
            const netPrice = finalUnitPrice * quantity;
            return { netPrice, unitPrice: finalUnitPrice };
        }
    };
    const ui = {
        renderOptions: () => {
            dom.shapeOptions.innerHTML = CONFIG.shapes.map(s => `<button type="button" data-shape="${s.id}" class="option-button border-2 border-gray-300 rounded-lg p-2 text-center text-sm md:text-base">${s.icon}<span class="font-semibold">${s.name}</span></button>`).join('');
            dom.materialOptions.innerHTML = CONFIG.materialOptions.map(m => `<button type="button" data-material="${m.id}" class="w-full text-left option-button border-2 border-gray-300 rounded-lg p-4"><span class="font-semibold">${m.name}</span></button>`).join('');
        },
        update: () => {
            ui.validateAll();
            const baseConfig = calculator.getBaseConfig();
            const { netPrice, unitPrice } = state.quantity ? calculator.forQuantity(state.quantity, baseConfig, CONFIG.priceTiers) : { netPrice: 0, unitPrice: 0 };
            const isValid = netPrice > 0 && state.quantity >= CONFIG.minimumQuantity && state.quantity <= CONFIG.maximumQuantity;
            let shapeName = state.shape ? CONFIG.shapes.find(s=>s.id===state.shape).name : '--';
            if (state.shape === 'rectangular' && state.roundedCorners) { shapeName = 'Rect. Redondeado'; } 
            else if (state.shape === 'circular' && state.width !== state.height) { shapeName = 'Óvalo'; }
            dom.summary.shape.textContent = shapeName;
            dom.summary.size.textContent = (state.width && state.height) ? `${state.width} x ${state.height} cm` : '--';
            const mat = CONFIG.materialOptions.find(m=>m.id===state.material);
            dom.summary.material.textContent = mat ? `${mat.name} ${state.finish ? `(${mat.finishes[state.finish].name})` : ''}` : '--';
            dom.summary.quantity.textContent = state.quantity ? `${state.quantity} u.` : '--';
            const ivaAmount = Math.round(netPrice * CONFIG.ivaRate);
            const totalPrice = netPrice + ivaAmount;
            const unitPriceFormatted = unitPrice < 100 ? unitPrice.toLocaleString('es-CL', {minimumFractionDigits: 1, maximumFractionDigits: 1}) : Math.round(unitPrice).toLocaleString('es-CL');
            dom.summary.unitPrice.textContent = `$${unitPrice > 0 ? unitPriceFormatted : '0'}`;
            dom.summary.netPrice.textContent = `$${Math.round(netPrice).toLocaleString('es-CL')}`;
            dom.summary.ivaPrice.textContent = `$${ivaAmount.toLocaleString('es-CL')}`;
            dom.summary.totalPrice.textContent = `$${Math.round(totalPrice).toLocaleString('es-CL')}`;
            if (isValid) {
                dom.summary.totalPriceWrapper.classList.remove('price-updated');
                void dom.summary.totalPriceWrapper.offsetWidth;
                dom.summary.totalPriceWrapper.classList.add('price-updated');
            }
            dom.submitButton.disabled = !isValid;
            dom.submitButton.classList.toggle('ready-to-submit', isValid);
        },
        validateInput: (input, errorEl, touchedFlag) => {
            if (!touchedFlag) return true;
            const value = parseFloat(input.value);
            let errorMessage = '';
            if (input.value === '') {} 
            else if (isNaN(value) || value <= 0) { errorMessage = 'Debe ser positivo.'; } 
            else if (input.id === 'quantity') {
                if (value < CONFIG.minimumQuantity) errorMessage = `Mínimo: ${CONFIG.minimumQuantity} u.`;
                if (value > CONFIG.maximumQuantity) errorMessage = `Máximo: ${CONFIG.maximumQuantity} u.`;
            }
            errorEl.textContent = errorMessage;
            errorEl.classList.toggle('hidden', !errorMessage);
            input.classList.toggle('invalid', !!errorMessage);
            return !errorMessage;
        },
        validateAll: () => {
            ui.validateInput(dom.inputs.width, dom.errors.width, state.touched.width);
            ui.validateInput(dom.inputs.height, dom.errors.height, state.touched.height);
            ui.validateInput(dom.inputs.quantity, dom.errors.quantity, state.touched.quantity);
        }
    };
    const events = {
        bind: () => {
            dom.shapeOptions.addEventListener('click', e => {
                const button = e.target.closest('button'); if (!button) return;
                state.shape = button.dataset.shape;
                dom.shapeOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected-option'));
                button.classList.add('selected-option');
                const showCorners = state.shape === 'rectangular';
                dom.roundedCornersContainer.classList.toggle('hidden', !showCorners);
                if (!showCorners) {
                    state.roundedCorners = false;
                    dom.roundedCornersCheckbox.checked = false;
                }
                if (state.shape === 'circular') {
                    dom.inputs.height.value = dom.inputs.width.value;
                    state.height = state.width;
                    dom.inputs.height.disabled = true;
                } else {
                    dom.inputs.height.disabled = false;
                }
                ui.update();
            });
            dom.roundedCornersCheckbox.addEventListener('change', e => {
                state.roundedCorners = e.target.checked;
                ui.update();
            });
            dom.materialOptions.addEventListener('click', e => {
                const button = e.target.closest('button'); if (!button) return;
                state.material = button.dataset.material; state.finish = null;
                dom.materialOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected-option'));
                button.classList.add('selected-option');
                const selectedMaterial = CONFIG.materialOptions.find(m => m.id === state.material);
                if (selectedMaterial) {
                    dom.finishOptions.innerHTML = Object.keys(selectedMaterial.finishes).map(key => `<button type='button' data-finish='${key}' class='option-button border-2 border-gray-300 rounded-lg p-3 text-center'><span class='font-semibold'>${selectedMaterial.finishes[key].name}</span></button>`).join('');
                    dom.finishOptionsContainer.classList.remove('hidden');
                }
                ui.update();
            });
            dom.finishOptions.addEventListener('click', e => {
                const button = e.target.closest('button'); if (!button) return;
                state.finish = button.dataset.finish;
                dom.finishOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected-option'));
                button.classList.add('selected-option');
                ui.update();
            });
            Object.keys(dom.inputs).forEach(key => {
                dom.inputs[key].addEventListener('input', e => {
                    state.touched[key] = true;
                    state[key] = parseFloat(e.target.value) || null;
                    if (key === 'width' && state.shape === 'circular') {
                        dom.inputs.height.value = e.target.value;
                        state.height = state.width;
                    }
                    ui.update();
                });
            });
        }
    };
    function main() {
        ui.renderOptions();
        events.bind();
        ui.update();
    }
    main();
});
</script>

</body>
</html>
```
